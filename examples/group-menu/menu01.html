<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Примеры. Создание меню для групп геообъектов из исходного javascript-массива.</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="//api-maps.yandex.ru/2.0/?load=package.full&lang=ru-RU&mode=debug" type="text/javascript"></script>
    <script src="//yandex.st/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
    <script src="groups.js" type="text/javascript"></script>
    <script type="text/javascript">
        ymaps.ready(init);

        function init() {
            // Создание экземпляра карты.
            var myMap = new ymaps.Map('map', {
                center: [50.443705, 30.530946],
                zoom: 14
            });

            // Контейнер для меню.
            var menu = $('<ul class="menu"/>');

            // Перебираем все группы.
            groups.forEach(function (group) {
                // Пункт меню.
                var menuItem = $('<li><a href="#">' + group.name + '</a></li>'),
                    // Коллекция для геообъектов группы.
                    collection = new ymaps.GeoObjectCollection(),
                    // Контейнер для подменю.
                    submenu = $('<ul class="submenu"/>');

                // Добавляем коллекцию на карту.
                myMap.geoObjects.add(collection);

                // Добавляем подменю.
                menuItem
                    .append(submenu)
                    // Добавляем пункт в меню.
                    .appendTo(menu)
                    // По клику удаляем/добавляем коллекцию на карту и скрываем/отображаем подменю.
                    .find('a')
                    .toggle(function () {
                        myMap.geoObjects.remove(collection);
                        submenu.hide();
                    }, function () {
                        myMap.geoObjects.add(collection);
                        submenu.show();
                    });

                // Перебираем элементы группы.
                group.items.forEach(function (item) {
                    // Пункт подменю.
                    var submenuItem = $('<li><a href="#">' + item.name + '</a></li>'),
                        // Создаем метку.
                        placemark = new ymaps.Placemark(item.center, { balloonContent: item.name });

                    // Добавляем метку в коллекцию.
                    collection.add(placemark);
                    // Добавляем пункт в подменю.
                    submenuItem
                        .appendTo(submenu)
                        // При клике по пункту подменю открываем/закрываем баллун у метки.
                        .find('a')
                        .toggle(function () {
                            placemark.balloon.open();
                        }, function () {
                            placemark.balloon.close();
                        });
                });
            });
            // Добавляем меню в тэг BODY.
            menu.appendTo($('body'));
            // Выставляем масштаб карты чтобы были видны все группы.
            myMap.setBounds(myMap.geoObjects.getBounds());
        }
    </script>
    <style type="text/css">
    /* Оформление меню (начало)*/
        .menu {
            list-style: none;

            margin: 0;
            padding: 0;
        }
        .submenu {
            list-style: none;

            margin: 0 0 0 20px;
            padding: 0;
        }
        .submenu li {
            font-size: 90%;
        }
    /* Оформление меню (конец)*/
    </style>
</head>

<body>
    <div id="map" style="width:800px;height:480px;"/>
</body>

</html>

