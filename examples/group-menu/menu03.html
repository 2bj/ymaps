<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Примеры. Создание меню для групп геообъектов из исходного javascript-массива.</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="//api-maps.yandex.ru/2.0/?load=package.full&lang=ru-RU" type="text/javascript"></script>
    <script src="//yandex.st/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        ymaps.ready(init);

        function init() {
            // Создание экземпляра карты.
            var myMap = new ymaps.Map('map', {
                center: [50.443705, 30.530946],
                zoom: 14
            }),
            // Эту группу не будем добавлять на карту, чтобы помещенные в нее геообъекты были не видны.
            hidden = new ymaps.GeoObjectCollection(),
            // Эту группу добавим на карту.
            visible = new ymaps.GeoObjectCollection(),
            // Упорядоченные коллекции с геообъектами.
            group1 = new ymaps.GeoObjectArray({
                properties: {
                    id: 'group-1',
                    name: 'Известные памятники'
                }
            }, {
                preset: 'twirl#redIcon'
            }),
            group2 = new ymaps.GeoObjectArray({
                properties: {
                    id: 'group-2',
                    name: 'Покушайки'
                }
            }, {
                preset: 'twirl#greenIcon'
            }),
            group3 = new ymaps.GeoObjectArray({
                properties: {
                    id: 'group-3',
                    name: 'Оригинальные музейчики'
                }
            }, {
                preset: 'twirl#orangeIcon'
            }),
            group4 = new ymaps.GeoObjectArray({
                properties: {
                    id: 'group-4',
                    name: 'Красивости'
                }
            });

            // Наполняем группы геообъектами.
            group1
                .add(new ymaps.Placemark([50.426472, 30.563022], { id: 'group-1-1', balloonContent: 'Монумент &quot;Родина-Мать&quot;' }))
                .add(new ymaps.Placemark([50.45351, 30.516489], { id: 'group-1-1', balloonContent: 'Памятник &quot;Богдану Хмельницкому&quot;' }))
                .add(new ymaps.Placemark([50.454433, 30.529874], { id: 'group-1-1', balloonContent: 'Арка Дружбы народов' }));

            group2
                .add(new ymaps.Placemark([50.50955, 30.60791], { id: 'group-2-1', balloonContent: 'Ресторан &quot;Калинка-Малинка&quot;' }))
                .add(new ymaps.Placemark([50.429083, 30.521708], { id: 'group-2-2', balloonContent: 'Бар &quot;Сало-бар&quot;' }))
                .add(new ymaps.Placemark([50.450843, 30.498271], { id: 'group-2-3', balloonContent: 'Абсент-бар &quot;Палата №6&quot;' }))
                .add(new ymaps.Placemark([50.454834, 30.516498], { id: 'group-2-4', balloonContent: 'Ресторан &quot;Спотыкач&quot;' }));

            group3
                .add(new ymaps.Placemark([50.443334, 30.520163], { id: 'group-3-1', balloonContent: 'Музей грамзаписи и старинных музыкальных инструментов' }))
                .add(new ymaps.Placemark([50.446977, 30.505269], { id: 'group-3-2', balloonContent: 'Музей истории медицины или Анатомический театр' }))
                .add(new ymaps.Placemark([50.452512, 30.530889], { id: 'group-3-3', balloonContent: 'Музей воды. Водно-информационный центр' }));

            group4
                .add(new ymaps.Placemark([50.45987, 30.516174], { id: 'group-4-1', balloonContent: 'Замок Ричарда-Львиное сердце' }))
                .add(new ymaps.Placemark([50.445049, 30.528598], { id: 'group-4-2', balloonContent: '&quot;Дом с химерами&quot;' }))
                .add(new ymaps.Placemark([50.449156, 30.511809], { id: 'group-4-3', balloonContent: 'Дом Рыцаря' }));

            // Добавляем все группы в одну коллекцию.
            visible
                .add(group1)
                .add(group2)
                .add(group3)
                .add(group4)

            // Добавляем все группы на карту.
            myMap.geoObjects.add(visible);

            // Выставляем масштаб карты чтобы были видны все группы.
            myMap.setBounds(visible.getBounds());

            // Обрабатываем клики на пунктах меню.
            $('ul.menu>li>a').on('click', function (e) {
                // Отменяем основное поведение (переход по ссылке)
                e.preventDefault();

                // Пункт меню на котором кликнули.
                var target = $(e.target),
                    // Идентификатор группы.
                    id = target.attr('id'),
                    // Подменю.
                    submenu = target.closest('li').find('ul.submenu');

                groupToggle(id);
                submenu.toggle();
            });

            // Обрабатываем клики на пунктах подменю.
            $('ul.submenu>li>a').on('click', function (e) {
                // Отменяем основное поведение (переход по ссылке)
                e.preventDefault();

                // Пункт подменю на котором кликнули.
                var target = $(e.target),
                    // Идентификатор метки.
                    id = target.attr('id');

                itemToggle(id);
            });

            // Ищем нужную группу и добавляем/удаляем ее с карты.
            function groupToggle(id) {
                // Все группы лежат внутри одной коллекции, которую мы получили из YMapsML.
                var it, group;

                // Сначала ищем в видимой на карте коллекции.
                it = visible.getIterator();
                while(group = it.getNext()) {
                    if(group.properties.get('id') === id) {
                        hidden.add(group);
                        return;
                    }
                }

                // Если мы сюда попали, значит коллекция уже удалена и надо искать в удаленных.
                it = hidden.getIterator();
                while(group = it.getNext()) {
                    if(group.properties.get('id') === id) {
                        visible.add(group);
                        return;
                    }
                }
            }

            // Ищем нужную метку и открываем/закрываем ее балун.
            function itemToggle(id) {
                var it = visible.getIterator(),
                    group;

                while(group = it.getNext()) {
                    for(var i = 0, len = group.getLength(); i < len; i++) {
                        var placemark = group.get(i);

                        if(placemark.properties.get('id') === id) {
                            if(placemark.balloon.isOpen()) {
                                placemark.balloon.close();
                            }
                            else {
                                placemark.balloon.open();
                            }
                            return;
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/css">
    /* Оформление меню (начало)*/
        .menu {
            list-style: none;

            margin: 0;
            padding: 0;
        }
        .submenu {
            list-style: none;

            margin: 0 0 0 20px;
            padding: 0;
        }
        .submenu li {
            font-size: 90%;
        }
    /* Оформление меню (конец)*/
    </style>
</head>

<body>
    <div id="map" style="width:800px;height:480px;"></div>
    <ul class="menu">
        <li>
            <a id="group-1" href="#">Известные памятники</a>
            <ul class="submenu">
                <li><a id="group-1-1" href="#">Монумент "Родина-Мать"</a></li>
                <li><a id="group-1-2" href="#">Памятник "Богдану Хмельницкому"</a></li>
                <li><a id="group-1-3" href="#">Арка Дружбы народов</a></li>
            </ul>
        </li>
        <li>
            <a id="group-2" href="#">Покушайки</a>
            <ul class="submenu">
                <li><a id="group-2-1" href="#">Ресторан "Калинка-Малинка"</a></li>
                <li><a id="group-2-2" href="#">Бар "Сало-бар"</a></li>
                <li><a id="group-2-3" href="#">Абсент-бар "Палата №6"</a></li>
                <li><a id="group-2-4" href="#">Ресторан "Спотыкач"</a></li>
            </ul>
        </li>
        <li>
            <a id="group-3" href="#">Оригинальные музейчики</a>
            <ul class="submenu">
                <li><a id="group-3-1" href="#">Музей грамзаписи и старинных музыкальных инструментов</a></li>
                <li><a id="group-3-2" href="#">Музей истории медицины или Анатомический театр</a></li>
                <li><a id="group-3-3" href="#">Музей воды. Водно-информационный центр</a></li>
            </ul>
        </li>
        <li>
            <a id="group-4" href="#">Красивости</a>
            <ul class="submenu">
                <li><a id="group-4-1" href="#">Замок Ричарда-Львиное сердце</a></li>
                <li><a id="group-4-2" href="#">"Дом с химерами"</a></li>
                <li><a id="group-4-3" href="#">Дом Рыцаря</a></li>
            </ul>
        </li>
    </ul>
</body>

</html>
