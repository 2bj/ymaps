<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Примеры. Создание меню для групп геообъектов из исходного javascript-массива.</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="//api-maps.yandex.ru/2.0/?load=package.full&lang=ru-RU" type="text/javascript"></script>
    <script src="//yandex.st/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        ymaps.ready(init);

        function init() {
            // Создание экземпляра карты.
            var myMap = new ymaps.Map('map', {
                center: [50.443705, 30.530946],
                zoom: 14
            }),
            hidden = new ymaps.GeoObjectCollection(),
            visible;

            // Загрузка YMapsML-файла.
            ymaps.geoXml.load("http://api.yandex.ru/maps/doc/ymapsml/1.x/examples/xml/menufromymapsml.xml")
                .then(function (res) {
                    visible = res.geoObjects;

                    // Добавляем все группы на карту.
                    myMap.geoObjects.add(visible);

                    // Выставляем масштаб карты чтобы были видны все группы.
                    myMap.setBounds(myMap.geoObjects.getBounds());
                });

            // Обрабатываем клики на пунктах меню.
            $('ul.menu>li>a').on('click', function (e) {
                // Пункт меню на котором кликнули.
                var target = $(e.target),
                    // Имя группы.
                    name = target.text(),
                    // Подменю.
                    submenu = target.closest('li').find('ul.submenu');

                groupToggle(name);
                submenu.toggle();
            });
            j
            // Обрабатываем клики на пунктах подменю.
            $('ul.submenu>li>a').on('click', function (e) {
                // Пункт подменю на котором кликнули.
                var target = $(e.target),
                    // Имя метки.
                    name = target.text();

                itemToggle(name);
            });

            function groupToggle(name) {
                // Все группы лежат внутри одной коллекции, которую мы получили из YMapsML.
                var it, group;

                // Сначала ищем в видимой на карте коллекции.
                it = visible.getIterator();
                while(group = it.getNext()) {
                    if(group.properties.get('name') === name) {
                        hidden.add(group);
                        return;
                    }
                }

                // Если мы сюда попали, значит коллекция уже удалена и надо искать в удаленных.
                it = hidden.getIterator();
                while(group = it.getNext()) {
                    if(group.properties.get('name') === name) {
                        visible.add(group);
                        return;
                    }
                }
            }

            function itemToggle(name) {
                var it = visible.getIterator(),
                    group;

                while(group = it.getNext()) {
                    for(var i = 0, len = group.getLength(); i < l; i++) {
                        var placemark = group[i];

                        if(placemark.properties.get('name') === name) {
                            if(placemark.balloon.isOpen()) {
                                placemark.balloon.close();
                            }
                            else {
                                placemark.balloon.open();
                            }
                            return;
                        }
                    }
                }



        }
    </script>
    <style type="text/css">
    /* Оформление меню (начало)*/
        .menu {
            list-style: none;

            margin: 0;
            padding: 0;
        }
        .submenu {
            list-style: none;

            margin: 0 0 0 20px;
            padding: 0;
        }
        .submenu li {
            font-size: 90%;
        }
    /* Оформление меню (конец)*/
    </style>
</head>

<body>
    <div id="map" style="width:800px;height:480px;"/>
    <ul class="menu">
        <li>
            <a href="#">Известные памятники</a>
            <ul class="submenu">
                <li><a href="#">Монумент "Родина-Мать"</a></li>
                <li><a href="#">Памятник "Богдану Хмельницкому"</a></li>
                <li><a href="#">Арка Дружбы народов</a></li>
            </ul>
        </li>
        <li>
            <a href="#">Покушайки</a>
            <ul class="submenu">
                <li><a href="#">Ресторан "Калинка-Малинка"</a></li>
                <li><a href="#">Бар "Сало-бар"</a></li>
                <li><a href="#">Абсент-бар "Палата №6"</a></li>
                <li><a href="#">Ресторан "Спотыкач"</a></li>
            </ul>
        </li>
        <li>
            <a href="#">Оригинальные музейчики</a>
            <ul class="submenu">
                <li><a href="#">Музей грамзаписи и старинных музыкальных инструментов</a></li>
                <li><a href="#">Музей истории медицины или Анатомический театр</a></li>
                <li><a href="#">Музей воды. Водно-информационный центр</a></li>
            </ul>
        </li>
        <li>
            <a href="#">Красивости</a>
            <ul class="submenu">
                <li><a href="#">Замок Ричарда-Львиное сердце</a></li>
                <li><a href="#">"Дом с химерами"</a></li>
                <li><a href="#">Дом Рыцаря</a></li>
            </ul>
        </li>
    </ul>
</body>

</html>
